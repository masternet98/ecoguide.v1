# EcoGuide.v1 - 프로덕트 요구사항 명세서 (PRD)

## 📋 프로젝트 개요

### 프로젝트 명
**EcoGuide.v1** - AI 기반 환경 인식 및 객체 분석 플랫폼

### 비전 및 목표
실시간 이미지 분석을 통해 환경과 객체를 인식하고, 사용자에게 의미 있는 정보를 제공하는 지능형 분석 시스템 구축

### 핵심 가치 제안
- **멀티모달 AI 분석**: OpenAI Vision API + 로컬 컴퓨터 비전 모델 결합
- **실시간 처리**: 카메라 입력 및 파일 업로드를 통한 즉시 분석
- **확장 가능한 아키텍처**: 서비스 팩토리와 기능 레지스트리를 통한 모듈화
- **사용자 친화적 인터페이스**: Streamlit 기반의 직관적 웹 UI

---

## 🎯 현재 구현된 핵심 기능

### 1. 새로운 아키텍처 시스템 ✅
**상태**: ✅ 완료 (2025-09-07 최적화)
- **서비스 팩토리 패턴**: 모듈화된 서비스 생성 및 관리
- **애플리케이션 컨텍스트**: 중앙집중식 의존성 관리
- **기능 레지스트리**: 동적 기능 활성화/비활성화 시스템
- **에러 핸들링**: 체계적인 에러 처리 및 사용자 피드백

### 2. 이미지 분석 엔진 ✅
**상태**: ✅ 구현 완료
- **OpenAI Vision API 통합**: GPT-4V를 활용한 고수준 객체 인식
- **로컬 컴퓨터 비전 파이프라인**: YOLOv8, MediaPipe, rembg 통합
- **듀얼 분석 방식**: 클라우드와 로컬 모델의 장점 결합

### 3. 실시간 입력 시스템 ✅
**상태**: ✅ 구현 완료
- **카메라 캡처**: Streamlit 네이티브 카메라 위젯
- **파일 업로드**: 다양한 이미지 포맷 지원 (PNG, JPG, JPEG)
- **탭 기반 UI**: 카메라/갤러리 간 원활한 전환
- **세션 상태 관리**: 체계적인 이미지 데이터 보존

### 4. 크기 측정 기능 ⏸️
**상태**: ⏸️ 구현 완료 (일부 비활성화)
- **손 기반 스케일 추정**: MediaPipe Hands를 활용한 실물 크기 계산
- **거리 보정**: 촬영 거리에 따른 원근 보정
- **사용자 설정 가능**: 손 크기, 촬영 거리 커스터마이징

### 5. 관리자 기능 ✅
**상태**: ✅ 구현 완료
- **Cloudflared 터널 관리**: 외부 접근을 위한 터널 설정
- **시스템 모니터링**: 터널 상태 및 연결 정보 표시

---

## 🏗️ 현재 최적화된 시스템 아키텍처

### 계층별 구조 (2025-09-07 기준)
```
📁 ecoguide.v1/
├── 🎯 app.py                # 새 아키텍처 적용된 메인 앱
├── 📄 pages/admin.py        # 관리자 페이지
├── 🔧 src/
│   ├── 🏛️ core/             # 핵심 레이어 (새 아키텍처)
│   │   ├── config.py        # 중앙화된 설정 관리
│   │   ├── session_state.py # 세션 상태 관리
│   │   ├── ui.py            # 공통 UI 컴포넌트
│   │   ├── utils.py         # 공통 유틸리티
│   │   ├── app_factory.py   # 📈 애플리케이션 팩토리
│   │   ├── base_service.py  # 📈 서비스 기본 클래스
│   │   ├── config_validator.py # 📈 설정 검증
│   │   ├── dependency_manager.py # 📈 의존성 관리
│   │   ├── error_handler.py # 📈 에러 처리 시스템
│   │   ├── feature_registry.py # 📈 기능 레지스트리
│   │   └── service_factory.py # 📈 서비스 팩토리
│   ├── 🔌 services/         # 서비스 레이어
│   │   ├── openai_service.py     # 📈 최적화된 OpenAI API 통합
│   │   ├── vision_service.py     # 로컬 CV 파이프라인
│   │   ├── tunnel_service.py     # 터널 관리
│   │   └── vision_types.py       # 데이터 클래스
│   └── 🎨 components/       # UI 컴포넌트
│       ├── measure_ui.py    # 측정 도구 UI
│       └── tunnel_ui.py     # 터널 관리 UI
├── 🧪 test/                 # 테스트 스위트
├── 🤖 models/               # ML 모델 저장소
└── 📚 [문서화]
    ├── CLAUDE.md            # 개발 가이드
    ├── REFACTORING_SUMMARY.md
    └── 📁 prompts/prd.md    # 본 문서
```

### 새로운 아키텍처 특징
1. **서비스 팩토리 패턴**: 모든 서비스가 중앙에서 관리
2. **의존성 주입**: 설정과 서비스가 명시적으로 전달
3. **기능 레지스트리**: 실행 중 기능 상태 모니터링
4. **에러 핸들링**: 데코레이터 기반 체계적 에러 처리

### 데이터 흐름
1. **초기화** → `get_application()` → 애플리케이션 컨텍스트 생성
2. **입력** → 카메라/파일 업로드 → 세션 상태 관리
3. **전처리** → JPEG 변환 → 크기/품질 최적화  
4. **분석** → 서비스 팩토리를 통한 OpenAI 서비스 호출
5. **후처리** → JSON 구조화 → 에러 처리 → 결과 표시

---

## 🚀 확장 계획 및 로드맵

### Phase 1: 레거시 코드 완전 정리 (우선순위: 높음)
**목표**: 새 아키텍처로 완전 전환 및 최적화

#### 1.1 레거시 코드 제거 완료 ✅
- [x] `app_new.py` → `app.py` 대체 완료
- [x] `openai_service_new.py` → `openai_service.py` 통합 완료
- [ ] `src/core/utils.py` 내 레거시 함수 정리
- [ ] 사용하지 않는 임포트 및 의존성 제거

#### 1.2 아키텍처 완성도 향상
- [ ] 모든 서비스의 팩토리 패턴 적용 검증
- [ ] 기능 레지스트리 완전 구현
- [ ] 에러 핸들링 시스템 전면 테스트

#### 1.3 성능 최적화
- [ ] 서비스 초기화 시간 단축
- [ ] 메모리 사용량 최적화
- [ ] 캐시 전략 개선

### Phase 2: 분석 엔진 고도화 (우선순위: 높음)
**목표**: 더 정확하고 다양한 분석 기능 제공

#### 2.1 멀티모달 분석 확장
- [ ] **텍스트 추출**: OCR 기능 통합 (Tesseract/PaddleOCR)
- [ ] **음성 분석**: 비디오 입력 시 오디오 추출 및 분석
- [ ] **움직임 감지**: 비디오 스트림에서 동작 패턴 인식
- [ ] **배경 분석**: 환경 컨텍스트 이해 및 분석

#### 2.2 고급 객체 인식
- [ ] **세분화된 카테고리**: 현재 일반적 분류를 세부 카테고리로 확장
- [ ] **속성 인식**: 색상, 재질, 상태, 크기 등 객체 속성 분석
- [ ] **관계 분석**: 객체 간의 공간적, 의미적 관계 파악
- [ ] **품질 평가**: 객체 상태 및 품질 자동 평가

#### 2.3 실시간 스트림 처리
- [ ] **웹캠 실시간 분석**: 연속적인 프레임 분석
- [ ] **배치 처리**: 다중 이미지 일괄 분석
- [ ] **스트리밍 최적화**: 메모리 효율성 및 지연시간 최소화
- [ ] **적응형 분석**: 실시간 성능에 따른 분석 품질 조절

### Phase 3: 사용자 경험 개선 (우선순위: 중간)
**목표**: 직관적이고 반응성 좋은 사용자 인터페이스

#### 3.1 고급 UI 컴포넌트
- [ ] **인터랙티브 결과 시각화**: 차트, 그래프, 히트맵
- [ ] **드래그 앤 드롭**: 다중 파일 업로드 인터페이스
- [ ] **진행률 표시**: 장시간 분석 작업 진행 상황 표시
- [ ] **결과 비교**: 다중 이미지 분석 결과 비교 뷰

#### 3.2 개인화 및 설정
- [ ] **사용자 프로필**: 개인별 분석 선호도 저장
- [ ] **히스토리 관리**: 분석 기록 저장 및 재검토
- [ ] **즐겨찾기**: 자주 사용하는 설정 프리셋
- [ ] **테마 설정**: 다크모드, 라이트모드 지원

#### 3.3 모바일 최적화
- [ ] **반응형 디자인**: 모바일 기기 지원 강화
- [ ] **터치 인터페이스**: 터치 친화적 UI 요소
- [ ] **오프라인 모드**: 제한적 로컬 처리 기능
- [ ] **PWA 지원**: 웹앱으로 설치 가능

### Phase 4: 데이터 관리 및 분석 (우선순위: 중간)
**목표**: 축적된 데이터를 활용한 인사이트 생성

#### 4.1 데이터베이스 통합
- [ ] **분석 결과 저장**: SQLite/PostgreSQL 통합
- [ ] **메타데이터 관리**: 이미지 정보, 분석 설정, 결과 연결
- [ ] **데이터 내보내기**: CSV, JSON, API 형태 데이터 제공
- [ ] **백업 및 복원**: 데이터 안전성 보장

#### 4.2 통계 및 인사이트
- [ ] **트렌드 분석**: 시간별, 카테고리별 분석 패턴
- [ ] **정확도 추적**: 모델별 성능 비교 및 개선점 도출
- [ ] **사용자 행동 분석**: UI 사용 패턴 및 개선 방향
- [ ] **예측 모델**: 사용 패턴 기반 예측 기능

#### 4.3 리포팅 시스템
- [ ] **자동 리포트 생성**: 주기적 분석 결과 요약
- [ ] **대시보드**: 실시간 시스템 상태 및 성능 모니터링
- [ ] **알림 시스템**: 임계값 기반 자동 알림
- [ ] **PDF 리포트**: 분석 결과 PDF 출력

### Phase 5: 플랫폼 확장 (우선순위: 낮음)
**목표**: 다양한 도메인으로 활용 영역 확대

#### 5.1 도메인별 특화 모델
- [ ] **환경 모니터링**: 쓰레기 분류, 오염 감지, 생태계 분석
- [ ] **품질 검사**: 제조업 품질 관리, 결함 감지
- [ ] **보안 감시**: 이상 행동 감지, 위험 상황 알림
- [ ] **교육 도구**: 학습 보조, 시각적 설명 생성

#### 5.2 API 및 통합
- [ ] **RESTful API**: 외부 시스템 통합을 위한 API 제공
- [ ] **웹훅**: 실시간 결과 전송 시스템
- [ ] **SDK 개발**: Python, JavaScript 클라이언트 라이브러리
- [ ] **플러그인 시스템**: 외부 개발자를 위한 확장 인터페이스

#### 5.3 클라우드 및 스케일링
- [ ] **컨테이너화**: Docker를 활용한 배포 최적화
- [ ] **로드 밸런싱**: 다중 인스턴스 처리
- [ ] **자동 스케일링**: 수요에 따른 자원 조정
- [ ] **마이크로서비스**: 기능별 독립 서비스 분리

---

## 🔧 기술적 고려사항

### 성능 최적화
- **이미지 처리 최적화**: 배치 처리, 병렬화, 메모리 관리
- **모델 경량화**: 프로덕션 환경을 위한 모델 압축 및 최적화
- **캐싱 전략**: 중복 분석 방지 및 응답 속도 향상
- **비동기 처리**: 논블로킹 I/O를 통한 성능 개선

### 보안 강화
- **API 키 관리**: 환경변수 기반 보안 강화, 키 로테이션
- **입력 검증**: 업로드 파일 타입, 크기, 내용 검증
- **데이터 암호화**: 민감 정보 저장 시 암호화
- **접근 제어**: 사용자 인증 및 권한 관리

### 확장성 설계
- **마이크로서비스 아키텍처**: 기능별 독립적 확장
- **이벤트 드리븐**: 비동기 처리 및 느슨한 결합
- **설정 기반**: 코드 변경 없는 기능 조정
- **플러그인 아키텍처**: 외부 확장 기능 지원

### 모니터링 및 관찰성
- **로깅**: 구조화된 로깅 및 중앙집중식 관리
- **메트릭**: 성능 지표 수집 및 모니터링
- **트레이싱**: 분산 추적을 통한 성능 분석
- **알람**: 이상 상황 자동 감지 및 알림

---

## 📊 성공 지표 (KPI)

### 기술적 성능
- **분석 정확도**: 95% 이상의 객체 인식 정확률
- **응답 시간**: 이미지당 3초 이내 분석 완료 (기존 5초에서 개선)
- **시스템 가용성**: 99.5% 이상 업타임
- **에러율**: 사용자 경험 오류 0.5% 미만 (기존 1%에서 개선)

### 사용자 만족도
- **사용자 참여도**: 월별 활성 사용자 증가율 15% 이상
- **기능 활용률**: 각 기능별 사용 빈도 분석 및 80% 이상 활용
- **사용자 피드백**: 평균 만족도 4.5/5.0 이상
- **재방문율**: 주간 재방문율 60% 이상

### 비즈니스 임팩트
- **처리량**: 월별 분석 이미지 수 10,000건 이상
- **효율성**: 수동 분석 대비 시간 단축률 80% 이상
- **확장성**: 분기별 신규 사용 사례 적용 2건 이상
- **비용 효율성**: 인프라 비용 대비 처리량 최적화

---

## 🛠️ 개발 환경 및 도구

### 현재 기술 스택
- **Frontend**: Streamlit (Python 3.8+)
- **Backend**: Python 서비스 아키텍처
- **AI/ML**: OpenAI GPT-4V, YOLOv8, MediaPipe, rembg
- **Infrastructure**: Cloudflared 터널, Docker (예정)
- **Testing**: pytest, 통합 테스트
- **Monitoring**: 커스텀 에러 핸들링 시스템

### 개발 도구 및 워크플로우
- **IDE**: VS Code with Python extensions
- **Version Control**: Git with feature branch workflow
- **Package Management**: pip, requirements.txt, 가상환경
- **Documentation**: Markdown, 자동 생성 API 문서
- **CI/CD**: GitHub Actions (예정)

### 품질 보증
- **Code Quality**: Black (포매팅), Flake8 (린팅)
- **Type Checking**: mypy를 통한 타입 검증
- **Testing**: 단위 테스트, 통합 테스트, E2E 테스트
- **Performance**: 프로파일링 및 성능 모니터링

---

## 📈 향후 확장 시나리오

### 시나리오 1: 교육 플랫폼 통합
- **목표**: AI 기반 시각적 학습 도구
- **기능**: 
  - 교육용 객체 인식 및 설명
  - 인터랙티브 학습 카드 생성
  - 퀴즈 모드 및 진도 추적
  - 다국어 지원 (한국어, 영어, 중국어)
- **타겟**: 초중고 과학 교육, 언어 학습, 특수 교육
- **기대 효과**: 개인 맞춤형 학습, 시각적 이해도 향상

### 시나리오 2: 비즈니스 솔루션
- **목표**: 기업용 품질 관리 및 자동화 시스템
- **기능**:
  - 제품 불량 감지 및 분류
  - 실시간 품질 통계 리포팅
  - 작업자 교육 프로그램
  - ERP 시스템 연동
- **타겟**: 제조업, 물류업, 식품업, 서비스업
- **기대 효과**: 품질 향상, 비용 절감, 자동화 확대

### 시나리오 3: 개인 생산성 도구
- **목표**: AI 기반 개인 관리 및 추천 시스템
- **기능**:
  - 스마트 옷장 관리 및 코디 추천
  - 식품 재고 추적 및 레시피 추천
  - 건강 관련 객체 모니터링
  - 개인 데이터 보호 강화
- **타겟**: 일반 소비자, 라이프스타일 앱
- **기대 효과**: 생활 편의 향상, 개인화 서비스

### 시나리오 4: 환경 모니터링 플랫폼
- **목표**: 대규모 환경 데이터 수집 및 분석
- **기능**:
  - 드론 연동 환경 모니터링
  - 쓰레기 및 오염 자동 감지
  - 생태계 변화 추적
  - 정부 기관 데이터 연동
- **타겟**: 환경 기관, NGO, 지자체
- **기대 효과**: 환경 보호, 데이터 기반 정책 수립

---

## 🎯 다음 단계 실행 계획

### 즉시 실행 (1-2주)
1. **레거시 코드 완전 정리**: ✅ 완료
   - [x] `app_new.py` 통합 완료
   - [x] `openai_service_new.py` 통합 완료
   - [ ] 남은 레거시 함수 정리

2. **테스트 커버리지 확대**: 새 아키텍처 검증
   - [ ] 서비스 팩토리 테스트
   - [ ] 에러 핸들링 테스트
   - [ ] 통합 테스트 추가

3. **문서화 업데이트**: 
   - [x] PRD 문서 생성 완료
   - [ ] 개발자 가이드 업데이트
   - [ ] API 문서 자동 생성

### 단기 실행 (1-2개월)
1. **기능 레지스트리 완성**: 동적 기능 관리 시스템
2. **멀티모달 분석**: OCR 기능 추가
3. **실시간 스트림**: 웹캠 연속 분석
4. **UI/UX 개선**: 인터랙티브 결과 시각화

### 중기 실행 (3-6개월)
1. **데이터베이스 통합**: 분석 결과 영구 저장
2. **도메인 특화**: 환경 모니터링 기능 개발
3. **API 개발**: 외부 통합 인터페이스
4. **모바일 최적화**: PWA 및 반응형 디자인

### 장기 실행 (6개월 이상)
1. **플랫폼 확장**: 다양한 도메인 적용
2. **클라우드 스케일링**: 자동 확장 인프라
3. **AI 모델 고도화**: 커스텀 모델 개발
4. **파트너십**: 교육기관, 기업과의 협력

---

## 🔄 지속적 개선 프로세스

### 월별 검토 사항
- **성능 지표 분석**: KPI 달성도 점검
- **사용자 피드백 수집**: 개선점 도출
- **기술 트렌드 반영**: 최신 AI 기술 적용
- **보안 업데이트**: 취약점 점검 및 패치

### 분기별 전략 회의
- **로드맵 재검토**: 우선순위 재조정
- **리소스 배분**: 개발 자원 최적화
- **파트너십 검토**: 새로운 협력 기회
- **시장 분석**: 경쟁 상황 및 기회 분석

---

## 📞 연락처 및 기여 방법

이 PRD는 지속적으로 업데이트되는 살아있는 문서입니다. 
새로운 아이디어나 개선 사항이 있으면 언제든지 이 문서를 참조하여 개발을 진행하세요.

### 문서 관리
- **작성자**: Claude Code
- **최신 업데이트**: 2025-09-07 (새 아키텍처 적용 완료)
- **다음 검토 예정일**: 2025-10-07
- **버전**: v2.0 (아키텍처 최적화 버전)

### 주요 변경 사항 (v2.0)
1. ✅ 서비스 팩토리 패턴 적용 완료
2. ✅ 레거시 코드 제거 및 통합 완료
3. ✅ 에러 핸들링 시스템 구축 완료
4. 📈 확장 계획 구체화 및 우선순위 재설정
5. 📊 성능 지표 개선 목표 설정

---

*이 문서는 EcoGuide.v1 프로젝트의 공식 제품 요구사항 명세서입니다. 모든 개발 작업은 이 문서를 기반으로 진행됩니다.*