# EcoGuide 관리자 가이드 🛠️
## 지자체 담당자를 위한 완전 가이드

---

## 📋 목차

1. [빠른 시작](#빠른-시작)
2. [관리자 페이지 구조](#관리자-페이지-구조)
3. [주요 기능별 상세 가이드](#주요-기능별-상세-가이드)
4. [자동화 설정](#자동화-설정)
5. [모니터링 & 분석](#모니터링--분석)
6. [FAQ & 트러블슈팅](#faq--트러블슈팅)

---

## 빠른 시작

### 관리자 접속하기

**URL**:
```
https://ecoguide.streamlit.app/
```

**관리자 페이지 접근**:
1. 왼쪽 사이드바 메뉴 보기
2. "🔑 관리자" 섹션 확장
3. 원하는 페이지 클릭

### 관리자 페이지 종류

| # | 페이지명 | 기능 | 접근 |
|---|---------|------|------|
| 01 | 행정구역 설정 | 지자체 기본정보 | `pages/01_district_config.py` |
| 02 | 지역 링크 관리 | 배출 정보 URL | `pages/02_district_links.py` |
| 03 | 지역 모니터링 | 자동 감시 & 알림 | `pages/03_district_monitoring.py` |
| 04 | 프롬프트 관리 | AI 학습 프롬프트 | `pages/04_prompt_admin.py` |
| 05 | 라벨링 대시보드 | 학습 데이터 관리 | `pages/05_labeling_dashboard.py` |
| 06 | 시스템 로그 | 실시간 모니터링 | `pages/06_logs.py` |
| 91 | 터널 관리 | 외부 접근 제어 | `pages/91_tunnel_management.py` |
| 99 | 시스템 정보 | 앱 상태 & 버전 | `pages/99_system_info.py` |

---

## 관리자 페이지 구조

### 전체 관리 흐름

```
┌─────────────────────────────────────┐
│ EcoGuide 관리자 대시보드             │
└────────────┬────────────────────────┘
             │
    ┌────────┴────────┬──────────┬──────────┬──────────┐
    ▼                 ▼          ▼          ▼          ▼
┌─────────┐  ┌──────────┐  ┌────────┐ ┌────────┐ ┌────────┐
│ 행정구역 │  │ 링크관리 │  │모니터링 │ │프롬프트 │ │라벨관리 │
│ 기본정보 │  │ URL관리  │  │자동감지 │ │AI학습  │ │학습데이터
└─────────┘  └──────────┘  └────────┘ └────────┘ └────────┘
     │            │             │          │         │
     │            │             │          │         │
     ▼            ▼             ▼          ▼         ▼
  CSV 업로드  URL 입력    자동 실행    프롬프트   통계 조회
  자동 갱신    유효성검사   이메일 알림  수정 배포  이미지 열람
  파일관리    파일첨부     대시보드표시  롤백      데이터 삭제
```

---

## 주요 기능별 상세 가이드

### 1️⃣ 행정구역 설정 (01_district_config.py)

**목적**: 국가 공식 행정구역 데이터 관리

#### 초기 설정 (1회만)

**Step 1: CSV 파일 준비**
```
출처: https://www.data.go.kr (공공데이터포털)
검색: "행정구역" 또는 "법정동"
```

**Step 2: 파일 업로드**

```
┌────────────────────────────────────┐
│ 01_district_config.py              │
├────────────────────────────────────┤
│ 📤 CSV 파일 업로드                 │
│                                    │
│ [파일 선택] (CSV 형식만 지원)      │
│ > 예시: 행정구역_2025.csv          │
│                                    │
│ [업로드 및 처리] 버튼             │
└────────────────────────────────────┘
```

**Step 3: 자동 처리 대기**

```
처리 중...
├─ CSV 파싱 (1초)
├─ 중복 검사 (2초)
├─ JSON 변환 (1초)
└─ 완료!

📊 처리 결과:
  원본: 5,000건
  정제: 4,800건
  제거됨: 200건 (중복)
  성공률: 96%
```

#### 정기 관리 (월 1회)

**자동 갱신 설정**:

```
┌────────────────────────────────────┐
│ 자동 갱신 설정                     │
├────────────────────────────────────┤
│ ⏰ 자동 갱신: [켜기/끄기]         │
│                                    │
│ 📅 갱신 간격:                     │
│    ○ 매일                         │
│    ○ 매주 월요일                  │
│    ○ 매달 1일 (권장) ✓            │
│                                    │
│ 📧 알림 설정:                     │
│    변경 발생 시 이메일 알림        │
│    [admin@city.go.kr]             │
│                                    │
│ [저장]                             │
└────────────────────────────────────┘
```

**자동 갱신 작동 원리**:

```
매달 1일 01:00 자동 실행
  ↓
공공데이터포털 접속
  ↓
최신 파일 다운로드
  ↓
로컬 파일과 비교
  ↓
변경사항 발견?
  ├─ YES: JSON 업데이트 + 이메일 알림
  └─ NO: 그대로 유지
```

#### 파일 관리

**버전별 조회**:

```
┌────────────────────────────────────┐
│ 저장된 파일 목록                   │
├──────────┬──────────┬──────────────┤
│ 파일명   │ 크기     │ 수정일       │
├──────────┼──────────┼──────────────┤
│ dist...1 │ 5.2MB    │ 2025-01-01   │
│ dist...2 │ 5.1MB    │ 2024-12-01   │
│ dist...3 │ 5.0MB    │ 2024-11-01   │
└──────────┴──────────┴──────────────┘

[개별 삭제] [일괄 초기화]
```

**권장 정책**:
- ✅ 최근 3개월 파일 보관
- ✅ 월 1회 갱신
- ✅ 변경사항 발생 시 즉시 적용

---

### 2️⃣ 지역 링크 관리 (02_district_links.py)

**목적**: 각 지역의 폐기물 처리 정보 URL 일원 관리

#### 새 지역 링크 추가

**Step 1: 지역 선택**

```
┌────────────────────────────────────┐
│ 새 지역 링크 추가                  │
├────────────────────────────────────┤
│ 🏢 시도 선택                      │
│ [인천광역시 ▼]                    │
│                                    │
│ 🏘️ 시군구 선택                   │
│ [서구 ▼]                          │
│                                    │
│ [선택된 지역: 인천광역시 서구]    │
└────────────────────────────────────┘
```

**Step 2: 4가지 URL 입력**

```
┌────────────────────────────────────┐
│ URL 정보 입력                      │
├────────────────────────────────────┤
│ 📌 배출 정보 URL                  │
│ [https://incheon.go.kr/waste]     │
│ (배출 방법, 수수료, 규정 등)       │
│                                    │
│ 📌 신청 시스템 URL                │
│ [https://incheon.go.kr/apply]     │
│ (실제 신청하는 곳)                 │
│                                    │
│ 📌 수수료 정보 URL                │
│ [https://incheon.go.kr/fee]       │
│ (요금 테이블)                      │
│                                    │
│ 📌 기전제품 정보 URL              │
│ [https://incheon.go.kr/appliance] │
│ (냉장고, 에어컨 등)                │
│                                    │
│ [저장]                             │
└────────────────────────────────────┘
```

**Step 3: 파일 첨부 (선택사항)**

```
┌────────────────────────────────────┐
│ 첨부 파일 추가                     │
├────────────────────────────────────┤
│ 📎 정책 문서:                     │
│    [인천시_2025_대형폐기물.pdf]    │
│                                    │
│ 📎 공지사항:                      │
│    [서구청_배출시스템_안내.docx]   │
│                                    │
│ [파일 추가] [저장]                │
└────────────────────────────────────┘
```

#### 링크 유효성 검사

**수동 검사**:

```
선택된 지역: 인천광역시 서구

[지금 확인] 버튼 클릭
  ↓
각 URL 접근 테스트 (3~10초)
  ↓
결과 표시:
  ✅ 배출정보: 정상 (응답시간 245ms)
  ✅ 신청시스템: 정상 (응답시간 312ms)
  ⚠️ 수수료정보: 느림 (응답시간 2500ms)
  ❌ 기전제품: 오류 (404 Not Found)
```

**자동 검사 설정**:

```
┌────────────────────────────────────┐
│ 자동 유효성 검사 설정              │
├────────────────────────────────────┤
│ ⏰ 자동 검사: [켜기] ✓            │
│                                    │
│ 📅 검사 간격:                     │
│    ○ 매일                         │
│    ○ 매주 (목요일) ✓             │
│    ○ 매달                         │
│                                    │
│ 📧 알림:                          │
│    ☑️ 오류 발생 시 알림           │
│    ☑️ 느린 응답 시 알림           │
│                                    │
│ [저장]                             │
└────────────────────────────────────┘
```

#### 대시보드 조회

```
┌────────────────────────────────────┐
│ 링크 관리 대시보드                 │
├────────────────────────────────────┤
│ 📊 통계:                          │
│    등록된 지역: 17개               │
│    총 URL 수: 68개                │
│    정상: 65개 ✅                  │
│    오류: 3개 ❌                   │
│                                    │
│ 🔗 지역별 링크 상태:              │
│                                    │
│ 지역             정상  오류  느림  │
│ ────────────────────────────────   │
│ 인천-서구         4    0    0     │
│ 인천-중구         4    0    1     │
│ 서울-강남구       3    1    0     │
│ ...              ...  ...  ...    │
│                                    │
│ [빠른 수정] [상세보기]            │
└────────────────────────────────────┘
```

---

### 3️⃣ 지역 모니터링 (03_district_monitoring.py)

**목적**: 배출 정보 변경 자동 감지 & 알림

#### 모니터링 설정

**기본 설정**:

```
┌────────────────────────────────────┐
│ 모니터링 설정                      │
├────────────────────────────────────┤
│ ⏰ 모니터링: [켜기] ✓            │
│                                    │
│ 📅 실행 간격:                     │
│    ○ 매일 02:00                  │
│    ○ 매주 월요일 02:00           │
│    ○ 매달 1일 02:00 ✓ (권장)    │
│                                    │
│ 🎯 감지 대상:                     │
│    ☑️ 콘텐츠 변경 (해시 비교)    │
│    ☑️ URL 접근 불가              │
│    ☑️ 응답 속도 저하 (>5초)      │
│    ☑️ 파일 수정 시간              │
│                                    │
│ 📧 알림 설정:                     │
│    변경 감지 시 대상자:            │
│    [admin@incheon.go.kr]          │
│    [waste@incheon.go.kr]          │
│    [add more...]                   │
│                                    │
│ [저장]                             │
└────────────────────────────────────┘
```

#### 수동 실행

```
┌────────────────────────────────────┐
│ 지금 모니터링 실행                 │
├────────────────────────────────────┤
│ [수동 실행 시작] 버튼             │
│                                    │
│ 진행 중...                         │
│ ├─ 인천 서구 확인 중... ✓ (2초)  │
│ ├─ 인천 중구 확인 중... ✓ (1.5초)│
│ ├─ 인천 동구 확인 중... ⚠️ (느림) │
│ ├─ 인천 남구 확인 중... ✓ (1초) │
│ └─ ...                            │
│                                    │
│ 완료! (총 45초)                   │
│                                    │
│ 📊 결과:                          │
│    검사: 68개 URL                 │
│    변경 감지: 3개                 │
│    오류: 1개                       │
│                                    │
│ [변경 내용 보기]                  │
└────────────────────────────────────┘
```

#### 변경 감지 이메일

**자동으로 받는 이메일**:

```
제목: ⚠️ EcoGuide 모니터링 알림: 3개 변경 감지

발신: ecoguide@no-reply.com
수신: admin@incheon.go.kr

본문:
─────────────────────────────────────

안녕하세요, 인천광역시 서구청 관리자님!

🔔 2025-01-15 02:00에 자동 모니터링을 실행한 결과,
   3개의 변경사항이 감지되었습니다.

📋 변경 상세:

1️⃣ 인천시 서구청 - 배출 정보 페이지
   ├─ 변경 유형: 콘텐츠 변경
   ├─ 변경 시간: 2025-01-14 16:30
   ├─ 변경 내용: "2025년 수수료 인상 - 18,000원→22,000원"
   ├─ URL: https://incheon.go.kr/waste
   └─ [변경 내용 상세보기]

2️⃣ 인천시 서구청 - 신청 시스템
   ├─ 변경 유형: 응답 속도 저하
   ├─ 변경 시간: 2025-01-15 01:45
   ├─ 이전: 312ms → 이후: 5,200ms
   ├─ URL: https://incheon.go.kr/apply
   └─ [조치 추천: 서버 재부팅 또는 호스팅 업체 문의]

3️⃣ 인천시 서구청 - 기전제품 정보
   ├─ 변경 유형: 파일 수정
   ├─ 변경 시간: 2025-01-14 14:20
   ├─ 문서: appliance_2025_new.pdf
   ├─ URL: https://incheon.go.kr/appliance
   └─ [문서 다운로드]

✅ 권장 조치:
1. 수수료 변경 → EcoGuide 앱에 즉시 반영
2. 응답 속도 → IT팀에 보고
3. 기전제품 정보 → 새 문서 확인 후 공지

─────────────────────────────────────
이 알림이 필요 없으면 대시보드에서 설정을 변경하세요.
```

#### 모니터링 대시보드

```
┌────────────────────────────────────┐
│ 모니터링 대시보드                  │
├────────────────────────────────────┤
│ 📊 최근 30일 통계:                │
│                                    │
│ 총 모니터링 횟수: 30회             │
│ 총 변경 감지: 12건                │
│ 총 오류: 2건                       │
│ 평균 응답시간: 2.3초               │
│                                    │
│ 📈 변경 트렌드:                   │
│ ┌─────────────────────────────┐  │
│ │ 변경건수                     │  │
│ │ 5 │         ●                │  │
│ │   │        ● ●              │  │
│ │ 3 │      ●   ●   ●          │  │
│ │   │    ●       ●   ●        │  │
│ │ 1 │●  ●        ●   ●   ●    │  │
│ │   └─────────────────────────┤  │
│ │    1월 5  10  15  20  25    │  │
│ └─────────────────────────────┘  │
│                                    │
│ 🔴 최근 오류 (2건):               │
│ • 2025-01-10: 서울강남구 URL 404   │
│ • 2025-01-05: 부산중구 타임아웃    │
│                                    │
│ ✅ 해결됨: 1건 (2025-01-12)        │
│                                    │
│ [상세 이력 보기]                  │
└────────────────────────────────────┘
```

---

### 4️⃣ 프롬프트 관리 (04_prompt_admin.py)

**목적**: AI 분석 프롬프트 생명주기 관리

#### 프롬프트 구조 이해

```
프롬프트란? AI에게 주는 '명령어'입니다.

예시:

이 이미지를 분석하고 다음을 구분하세요:
- 품목명
- 주분류 (가구, 가전, 건설재료 등)
- 중분류 (침대, 소파 등)
- 크기 측정 (가로×세로×깊이)
- 신뢰도 (0~100%)

반드시 JSON 형식으로 응답하세요.
```

#### 활성 프롬프트 조회

```
┌────────────────────────────────────┐
│ 현재 활성 프롬프트                 │
├────────────────────────────────────┤
│ 📌 분석 프롬프트 v3.2             │
│    └─ 마지막 수정: 2025-01-10    │
│    └─ 활성화: 2025-01-12         │
│    └─ 사용 횟수: 12,540회         │
│    └─ 평균 응답시간: 4.2초         │
│    └─ 성공률: 94.2%               │
│                                    │
│ 📌 분류 프롬프트 v2.1             │
│    └─ 마지막 수정: 2025-01-08    │
│    └─ 활성화: 2025-01-09         │
│    └─ 사용 횟수: 8,932회          │
│    └─ 성공률: 91.3%               │
│                                    │
│ 📌 가이던스 프롬프트 v1.5         │
│    └─ 마지막 수정: 2024-12-30    │
│    └─ 활성화: 2025-01-01         │
│    └─ 사용 횟수: 5,234회          │
│    └─ 성공률: 88.7%               │
│                                    │
│ [전체 목록 보기]                  │
└────────────────────────────────────┘
```

#### 프롬프트 수정

**Step 1: 프롬프트 선택**

```
┌────────────────────────────────────┐
│ 프롬프트 수정                      │
├────────────────────────────────────┤
│ 📌 수정할 프롬프트:               │
│ [분석 프롬프트 v3.2 ▼]            │
│                                    │
│ 버전 히스토리:                     │
│ • v3.2 (현재 활성) - 2025-01-10  │
│ • v3.1 - 2025-01-05              │
│ • v3.0 - 2024-12-28              │
│ • v2.9 - 2024-12-15              │
│                                    │
│ [선택 완료]                        │
└────────────────────────────────────┘
```

**Step 2: 프롬프트 편집**

```
┌────────────────────────────────────┐
│ 프롬프트 텍스트 편집              │
├────────────────────────────────────┤
│ 이 이미지의 폐기물을 다음 기준으로 │
│ 분석하세요:                       │
│                                    │
│ 1. 품목명 (정확한 물품 이름)      │
│ 2. 분류:                          │
│    - 주분류: {primary_category}  │
│    - 중분류: {secondary_category}│
│ 3. 크기: 가로×세로×깊이 (cm)     │
│ 4. 신뢰도: 0~100%                │
│ 5. 근거: 왜 이렇게 분류했는가    │
│                                    │
│ 위치 정보: {location}             │
│ 지역 규정: {district_context}    │
│                                    │
│ JSON 형식으로 응답하세요.         │
│                                    │
│ [미리보기] [저장] [취소]          │
└────────────────────────────────────┘
```

**Step 3: 테스트 실행**

```
┌────────────────────────────────────┐
│ 프롬프트 테스트                    │
├────────────────────────────────────┤
│ 테스트 이미지 선택:               │
│ [샘플 이미지 업로드]              │
│                                    │
│ [테스트 실행 시작]                │
│                                    │
│ 응답 예시:                         │
│ {                                  │
│   "item_name": "침대틀",          │
│   "primary": "가구",              │
│   "secondary": "침대",            │
│   "size": "200×100×50",          │
│   "confidence": 0.87,             │
│   "reason": "..."                 │
│ }                                  │
│                                    │
│ 응답시간: 4.3초                   │
│ 평가: ✅ 양호                     │
│                                    │
│ [더 테스트] [배포] [취소]         │
└────────────────────────────────────┘
```

**Step 4: 배포**

```
┌────────────────────────────────────┐
│ 프롬프트 배포                      │
├────────────────────────────────────┤
│ 프롬프트: 분석 프롬프트 v3.3     │
│ 변경사항:                          │
│  - 신뢰도 기준 하향조정            │
│  - 지역 정보 포함 추가             │
│  - 에러 핸들링 개선                │
│                                    │
│ ⚠️ 주의:                          │
│ 현재 활성 버전 (v3.2)을 덮어씀    │
│ 모든 사용자에게 즉시 적용됨        │
│                                    │
│ 💾 백업 생성: 자동                │
│                                    │
│ [배포 확인] [취소]                │
│                                    │
│ ✅ 배포 완료!                     │
│    2025-01-15 10:45에 적용됨      │
│    영향 사용자: 127명              │
└────────────────────────────────────┘
```

#### 롤백 (이전 버전 복구)

```
┌────────────────────────────────────┐
│ 문제 발생 시 롤백 방법            │
├────────────────────────────────────┤
│ 현재 프롬프트: v3.3 (문제 있음)   │
│                                    │
│ 버전 선택: v3.2 (이전 버전) ✓    │
│                                    │
│ [복원 실행]                        │
│                                    │
│ ✅ 롤백 완료!                     │
│    v3.2로 복원됨 (2025-01-15 11:00)
│                                    │
│ 롤백 사유: _________________       │
│           [입력]                   │
│                                    │
│ [저장]                             │
└────────────────────────────────────┘
```

---

### 5️⃣ 라벨링 대시보드 (05_labeling_dashboard.py)

**목적**: 사용자가 수집한 학습 데이터 관리

#### 통계 조회

```
┌────────────────────────────────────┐
│ 라벨 데이터 통계                   │
├────────────────────────────────────┤
│ 📊 전체 통계:                     │
│    총 라벨 수: 5,234개             │
│    최근 30일: 892개                │
│    마지막 업데이트: 2025-01-15    │
│                                    │
│ 📈 월별 증가 추세:                │
│    12월: 820개  ↗️ 12% 증가      │
│    1월: 892개   (현재)             │
│                                    │
│ 🏆 카테고리별 분포:               │
│    가구: 2,100개 (40.1%)          │
│    가전: 1,800개 (34.4%)          │
│    건설: 800개 (15.3%)            │
│    기타: 534개 (10.2%)            │
│                                    │
│ 👤 활성 사용자: 342명              │
│    이번달 피드백: 234명            │
│    평균 피드백율: 68%              │
└────────────────────────────────────┘
```

#### 데이터 검색

```
┌────────────────────────────────────┐
│ 라벨 데이터 검색                   │
├────────────────────────────────────┤
│ 🔍 필터:                          │
│    주분류: [가구 ▼]               │
│    중분류: [침대 ▼]               │
│    날짜: [2025-01-01 ~ 2025-01-15]│
│    신뢰도: [70% 이상 ▼]          │
│    사용자 확인: [확인함만 ▼]      │
│                                    │
│ [검색]                             │
│                                    │
│ 검색 결과: 342개                   │
│ (전체 2,100개 중)                  │
│                                    │
│ [그리드 크기] 1열 / 2열 / 4열 ✓  │
└────────────────────────────────────┘
```

#### 이미지 그리드 표시

```
┌────────────────────────────────────┐
│ 라벨 이미지 브라우저 (4열)        │
├────────────────────────────────────┤
│                                    │
│ [이미지] [이미지] [이미지] [이미지]│
│ 침대틀   소파    책장    침대      │
│ 신뢰도   신뢰도   신뢰도   신뢰도   │
│ 87%     92%     78%     85%     │
│                                    │
│ [이미지] [이미지] [이미지] [이미지]│
│ ...     ...     ...     ...     │
│                                    │
│ [이미지] [이미지]                │
│ ...     ...                     │
│                                    │
│ [첫 페이지] [◀] 1/34 [▶] [마지막]│
└────────────────────────────────────┘
```

#### 상세 정보 보기

**이미지 클릭 시**:

```
┌────────────────────────────────────┐
│ 라벨 상세 정보                     │
├────────────────────────────────────┤
│                                    │
│ [큰 이미지 표시]                  │
│                                    │
│ 📋 기본 정보:                     │
│    품목ID: 0dd9fbaf-4ac7...      │
│    업로드: 2025-01-10 14:32      │
│    사용자: 익명                   │
│                                    │
│ 🏷️ 분류 정보:                    │
│    주분류: 가구                   │
│    중분류: 침대                   │
│    세부: 침대틀                   │
│                                    │
│ 📐 크기:                          │
│    가로: 200cm                    │
│    세로: 100cm                    │
│    깊이: 50cm                     │
│                                    │
│ 🤖 AI 분석 정보:                 │
│    신뢰도: 85%                    │
│    응답시간: 4.2초                │
│    버전: v3.2                     │
│                                    │
│ 👤 사용자 확인:                   │
│    상태: ✅ 확인됨                │
│    메모: "목재 프레임, 약간 손상"  │
│    신뢰도: 95%                    │
│                                    │
│ 📊 품질 점수:                     │
│    AI 품질: 85%                   │
│    라벨 신뢰도: 95%               │
│    종합 점수: 90%                 │
│                                    │
│ [컬리 복사] [다운로드] [삭제]    │
└────────────────────────────────────┘
```

#### 데이터 정리

**저품질 데이터 삭제**:

```
┌────────────────────────────────────┐
│ 데이터 정리                        │
├────────────────────────────────────┤
│ 🗑️ 삭제 대상 선택:               │
│                                    │
│ ☑️ 신뢰도 50% 미만 (245개)       │
│ ☑️ 미확인 데이터 (128개)         │
│ ☑️ 이상 탐지 (12개)              │
│                                    │
│ 선택된 데이터: 385개              │
│                                    │
│ ⚠️ 주의: 삭제는 복구 불가능      │
│                                    │
│ [미리보기] [삭제 실행] [취소]    │
│                                    │
│ ✅ 삭제 완료!                     │
│    385개 라벨 삭제됨              │
│    남은 라벨: 4,849개             │
└────────────────────────────────────┘
```

**카테고리별 일괄 삭제**:

```
┌────────────────────────────────────┐
│ 카테고리별 관리                    │
├────────────────────────────────────┤
│ 🏷️ 가구 (2,100개)               │
│    └─ [보기] [다운로드] [삭제]    │
│                                    │
│ 🏷️ 가전 (1,800개)               │
│    └─ [보기] [다운로드] [삭제]    │
│                                    │
│ 🏷️ 건설 (800개)                 │
│    └─ [보기] [다운로드] [삭제]    │
│                                    │
│ 🏷️ 기타 (534개)                 │
│    └─ [보기] [다운로드] [삭제]    │
└────────────────────────────────────┘
```

---

### 6️⃣ 시스템 로그 (06_logs.py)

**목적**: 실시간 애플리케이션 모니터링

#### 실시간 로그 스트림

```
┌────────────────────────────────────┐
│ 실시간 로그 뷰어                   │
├────────────────────────────────────┤
│ 🔍 필터:                          │
│    레벨: [ERROR만 ▼]              │
│    컴포넌트: [모두 선택 ▼]        │
│    검색: [VWorld ___]             │
│                                    │
│ [자동 스크롤: ON]                 │
│                                    │
│ ───────────────────────────────   │
│ 2025-01-15 10:45:32 | ERROR      │
│ [WEB_API] location_service        │
│ VWorld API 오류 (502)             │
│                                    │
│ 2025-01-15 10:45:10 | ERROR      │
│ [FILE_OP] district_service        │
│ CSV 파싱 오류: 인코딩 문제        │
│                                    │
│ 2025-01-15 10:44:55 | WARNING    │
│ [API_CALL] openai_service         │
│ 응답 시간 초과: 8.5초 (기준: 5초) │
│                                    │
│ ───────────────────────────────   │
│                                    │
│ [다운로드] [지우기]                │
└────────────────────────────────────┘
```

#### 에러 분석 대시보드

```
┌────────────────────────────────────┐
│ 에러 분석                          │
├────────────────────────────────────┤
│ 📊 최근 24시간:                   │
│    총 이벤트: 12,340개             │
│    에러: 45개 (0.36%)              │
│    경고: 128개 (1.04%)             │
│                                    │
│ 🔴 상위 5개 에러:                 │
│    1. VWorld API 502 (12건)       │
│    2. CSV 인코딩 (8건)             │
│    3. OpenAI 타임아웃 (7건)        │
│    4. 이미지 처리 오류 (6건)       │
│    5. 파일 시스템 (4건)            │
│                                    │
│ 📈 컴포넌트별 오류율:              │
│    analysis: 0.42%                │
│    district: 0.38%                │
│    prompts: 0.12%                 │
│    infrastructure: 0.51%          │
│    monitoring: 0.08%              │
│                                    │
│ [상세 조사] [트렌드 보기]          │
└────────────────────────────────────┘
```

---

### 7️⃣ 터널 관리 (91_tunnel_management.py)

**목적**: 외부 네트워크 접근 제어

#### 터널 제어

```
┌────────────────────────────────────┐
│ Cloudflared 터널 제어              │
├────────────────────────────────────┤
│ 🔐 터널 상태: [실행 중 ✅]        │
│                                    │
│ 🌐 공개 URL:                      │
│    https://ecoguide-xyz.trycloudflare.com
│    (클릭하여 복사)                 │
│                                    │
│ 📊 연결 정보:                     │
│    시작 시간: 2025-01-15 09:00    │
│    연결 지속: 12시간 45분           │
│    활성 연결: 3개                  │
│                                    │
│ [중지]  [재시작]  [URL 갱신]      │
├────────────────────────────────────┤
│ ⚠️ 터널을 중지하면 외부 접근 불가 │
└────────────────────────────────────┘
```

#### 로그 조회

```
┌────────────────────────────────────┐
│ 터널 로그                          │
├────────────────────────────────────┤
│ 자동 스크롤: [ON]                │
│                                    │
│ 2025-01-15 10:45:23              │
│ [INFO] Tunnel connected           │
│ Routing hostname to tunnel         │
│                                    │
│ 2025-01-15 10:43:12              │
│ [INFO] New request                │
│ GET /admin/logs                    │
│ 🟢 200 OK (145ms)                │
│                                    │
│ 2025-01-15 10:42:50              │
│ [INFO] New request                │
│ POST /api/analyze                 │
│ 🟢 200 OK (4200ms)               │
│                                    │
│ 2025-01-15 10:41:35              │
│ [WARNING] Slow response            │
│ POST /api/monitor                 │
│ 🟡 200 OK (8500ms) - SLOW!       │
│                                    │
│ [더 보기]                          │
└────────────────────────────────────┘
```

---

## 자동화 설정

### 자동 갱신 파이프라인

```
매달 1일 02:00 자동 실행:

1️⃣ 행정구역 갱신
   data.go.kr 최신 파일 확인
   └─ 변경 있으면 업데이트 + 이메일

2️⃣ 링크 유효성 검사
   68개 URL 모두 접근 테스트
   └─ 오류 발견 시 즉시 알림

3️⃣ 모니터링 실행
   모든 배출 정보 페이지 확인
   └─ 콘텐츠 변경 감지 + 알림

4️⃣ 라벨 통계 생성
   월간 리포트 작성
   └─ 관리자에게 발송

5️⃣ 로그 분석
   에러 패턴 분석 + 리포트
   └─ 주간 이슈 리스트 생성
```

---

## 모니터링 & 분석

### 대시보드 해석

**🟢 정상 상태**:
- 응답시간 < 2초
- 오류율 < 1%
- 모든 URL 접근 가능

**🟡 주의 상태**:
- 응답시간 2~5초
- 오류율 1~5%
- 일부 URL 느림

**🔴 오류 상태**:
- 응답시간 > 5초
- 오류율 > 5%
- URL 접근 불가

---

## FAQ & 트러블슈팅

### Q1: 자동 갱신이 안 되는데요?

**A**: 확인해보세요:

1. **자동 갱신 설정 확인**
   - 페이지 > 자동 갱신 [켜기] 확인

2. **시간 확인**
   - 설정된 시간이 지났는가?
   - 예: 매달 1일 02:00

3. **로그 확인**
   - 시스템 로그에서 "갱신" 검색
   - 에러 메시지 확인

4. **서버 시간 확인**
   - 서버 시간이 정확한가?
   - NTP 동기화 확인

---

### Q2: 모니터링 이메일을 받지 못했어요

**A**: 확인 순서:

1. **이메일 주소 확인**
   - 설정 > 알림 > 이메일 주소 확인
   - 주소가 올바른가?

2. **스팸 폴더 확인**
   - 스팸함에 있을 수 있어요
   - "ecoguide@..." 발신자 확인

3. **권한 확인**
   - SMTP 설정이 올바른가?
   - 비밀번호가 만료되지 않았나?

4. **수동 실행으로 테스트**
   - "지금 확인" 버튼으로 수동 실행
   - 이메일 전송 확인

---

### Q3: 프롬프트 수정 후 바뀐 게 없어요

**A**: 캐시 때문일 수 있습니다:

1. **브라우저 캐시 삭제**
   - 설정 > 캐시 & 쿠키 삭제

2. **앱 새로고침**
   - F5 키 또는 Ctrl+R

3. **프롬프트 활성화 확인**
   - "배포" 버튼을 눌렀나?
   - 상태가 "활성" 표시인가?

4. **사용자 캐시**
   - 사용자도 새로고침 필요
   - 공지사항으로 안내

---

### Q4: 대용량 CSV 업로드가 느려요

**A**: 파일 분할 후 업로드:

1. **파일 크기 확인**
   - 50MB 이상은 분할 필요

2. **Excel로 분할**
   - 원본 파일을 여러 개로 나누기
   - 각각 10MB 이하로

3. **순차 업로드**
   - 첫 번째 파일 업로드
   - 완료 후 두 번째 업로드

4. **네트워크 확인**
   - WiFi 신호 좋은 곳에서
   - 유선 인터넷 권장

---

### Q5: 링크 유효성 검사가 모두 실패해요

**A**: 확인 사항:

1. **URL 형식 확인**
   - `https://` 로 시작?
   - 타이핑 오류 없나?

2. **사이트 접근성 확인**
   - 웹브라우저에서 직접 접속 시도
   - 실제로 접근 가능한가?

3. **방화벽 확인**
   - 회사 방화벽에 차단되나?
   - IT팀에 문의

4. **사이트 점검**
   - 해당 사이트가 점검 중일 수 있음
   - 나중에 다시 시도

---

### Q6: 프롬프트 롤백 방법이 잘 모르겠어요

**A**: 간단합니다:

1. **이전 버전 선택**
   - "버전 히스토리" 탭
   - 작동했던 버전 선택

2. **"복원" 클릭**
   - 즉시 적용됨
   - 모든 사용자에게 반영

3. **문제 해결**
   - 이전 버전으로 돌아갔으므로 안정적
   - 천천히 문제 원인 파악

4. **다시 시도**
   - 문제 수정 후 새 버전으로 배포

---

### Q7: 라벨 데이터가 너무 많아졌어요

**A**: 저장소 관리:

1. **자동 정리 설정**
   - 3개월 이상 된 데이터 자동 삭제
   - 저품질 데이터 (신뢰도 50% 미만) 자동 삭제

2. **수동 정리**
   - "데이터 정리" 메뉴 사용
   - 카테고리별로 선택적 삭제

3. **데이터 백업**
   - 삭제 전 항상 백업
   - CSV/JSON으로 내보내기

4. **저장소 성능**
   - 너무 많으면 로딩 느려질 수 있음
   - 주기적 정리 권장

---

### Q8: 터널 연결이 자꾸 끊겨요

**A**: 재시작 방법:

1. **수동 재시작**
   - "재시작" 버튼 클릭
   - 5초 정도 대기

2. **로그 확인**
   - 터널 로그에서 에러 확인
   - 반복되는 패턴 찾기

3. **클라우드플레어 상태**
   - https://www.cloudflarestatus.com/ 확인
   - 서비스 이슈 있는지 확인

4. **전문가 지원**
   - 반복되면 클라우드플레어에 문의
   - 또는 기술 지원팀 연락

---

## 📞 더 필요한 도움

**관리자 전용 문의**:
- 📧 email: admin-support@ecoguide.app
- 🐛 버그 제보: GitHub Issues
- 💬 기능 제안: GitHub Discussions

**자주 업데이트됨**:
- 이 가이드는 월 1회 업데이트됩니다
- 최신 버전을 항상 확인하세요

---

**마지막으로**:
이 시스템은 **당신의 피드백을 통해 계속 개선**됩니다.
사용 중 불편한 점이나 개선 아이디어가 있으면 언제든 알려주세요! 🙏

---

**버전**: 1.0
**마지막 업데이트**: 2025년 1월
**담당 부서**: EcoGuide 개발팀
**피드백**: GitHub Issues 또는 이메일

