"""
ì„¸ë¶€ë‚´ì—­ ì½˜í…ì¸  ì¶”ì¶œì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ ëª¨ë“ˆì…ë‹ˆë‹¤.

ì´ ëª¨ë“ˆì€ ë°°ì¶œì •ë³´ì™€ ìˆ˜ìˆ˜ë£Œ ì •ë³´ ì¶”ì¶œì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼
í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œì— ë“±ë¡í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
"""
from typing import Optional, Dict, Any
from src.app.core.prompt_types import PromptCategory, PromptStatus


def get_info_extraction_prompt_template() -> str:
    """ë°°ì¶œì •ë³´ ì¶”ì¶œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë°˜í™˜"""
    return """ë‹¹ì‹ ì€ ëŒ€í˜•íê¸°ë¬¼ ë°°ì¶œ ì •ë³´ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.{district_context}

ë‹¤ìŒ ì½˜í…ì¸ ì—ì„œ ë°°ì¶œì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•˜ì„¸ìš”:

---
{content}
---

ë‹¤ìŒê³¼ ê°™ì€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš” (í•„ìš”í•œ ì„¹ì…˜ë§Œ í¬í•¨):

## ğŸ“¦ ë°°ì¶œ ê°€ëŠ¥ ë¬¼í’ˆ
ëª©ë¡ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì‘ì„±

## â›” ë°°ì¶œ ë¶ˆê°€ëŠ¥ ë¬¼í’ˆ
ëª©ë¡ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì‘ì„±

## ğŸšš ë°°ì¶œ ë°©ë²•
ë°°ì¶œ ë°©ë²• ì„¤ëª…

## ğŸ“… ìˆ˜ê±° ì¼ì •
ìˆ˜ê±° ì¼ì • ì„¤ëª…

## ğŸ“ ì‹ ì²­ ë°©ë²•
### ì˜¨ë¼ì¸
ì˜¨ë¼ì¸ ì‹ ì²­ ë°©ë²• ë° ë§í¬

### ì „í™”
ì „í™”ë²ˆí˜¸ ë° ìƒë‹´ ì‹œê°„

### ë°©ë¬¸
ë°©ë¬¸ ì¥ì†Œ ë° ì£¼ì†Œ

## ğŸ’° ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ
ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ì„¤ëª…

## ğŸ‘¥ ì—°ë½ì²˜
- **ë‹´ë‹¹ì/ê¸°ê´€**: ì „í™”ë²ˆí˜¸ ë˜ëŠ” ë§í¬ (ìš©ë„ ì„¤ëª…)
- ì—¬ëŸ¬ í•­ëª© ê°€ëŠ¥

## â° ìš´ì˜ ì‹œê°„
ìš´ì˜ ì‹œê°„ ì„¤ëª…

## ğŸ“Œ ì¶”ê°€ ì •ë³´
ê¸°íƒ€ ì¤‘ìš” ì •ë³´

ì£¼ì˜ì‚¬í•­:
1. í˜ì´ì§€ì— ëª…ì‹œëœ ì •ë³´ë§Œ í¬í•¨í•˜ì„¸ìš”
2. ëª…ì‹œë˜ì§€ ì•Šì€ ì •ë³´ëŠ” ì ˆëŒ€ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš” (ì¶”ë¡  ê¸ˆì§€)
3. í•„ìš” ì—†ëŠ” ì„¹ì…˜ì€ ìƒëµí•´ë„ ë©ë‹ˆë‹¤
4. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ë§Œ ì‘ë‹µí•˜ì„¸ìš” (JSONì´ ì•„ë‹™ë‹ˆë‹¤)"""


def get_fee_extraction_prompt_template() -> str:
    """ìˆ˜ìˆ˜ë£Œ ì •ë³´ ì¶”ì¶œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë°˜í™˜"""
    return """ë‹¹ì‹ ì€ ëŒ€í˜•íê¸°ë¬¼ ìˆ˜ìˆ˜ë£Œ ì •ë³´ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.{district_context}

ë‹¤ìŒ ì½˜í…ì¸ ì—ì„œ ìˆ˜ìˆ˜ë£Œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•˜ì„¸ìš”:

---
{content}
---

ë‹¤ìŒê³¼ ê°™ì€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš” (í•„ìš”í•œ ì„¹ì…˜ë§Œ í¬í•¨):

## ğŸ“ ë°°ì¶œ ê¸°ì¤€
ë¬¼í’ˆì˜ í¬ê¸°ë‚˜ ì¢…ë¥˜ì— ë”°ë¥¸ ë°°ì¶œ ê¸°ì¤€ ì„¤ëª…

## ğŸ’µ ìš”ê¸ˆ í‘œ

### ì¹´í…Œê³ ë¦¬ëª…
- **ê¸°ì¤€1**: ìš”ê¸ˆ
- **ê¸°ì¤€2**: ìš”ê¸ˆ

### ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ëª…
- **ê¸°ì¤€1**: ìš”ê¸ˆ
- **ê¸°ì¤€2**: ìš”ê¸ˆ

## ğŸ“… ì˜ˆì•½ ë°©ë²•
ì˜ˆì•½ ë°©ë²• ì„¤ëª… (ì˜¨ë¼ì¸, ì „í™” ë“±)

## ğŸ’³ ê²°ì œ ë°©ë²•
ê²°ì œ ìˆ˜ë‹¨ ì„¤ëª…

## ğŸ í• ì¸
í• ì¸ ì •ë³´ (ìˆìœ¼ë©´)

## ğŸ“Œ ì¶”ê°€ ì •ë³´
ê¸°íƒ€ ì¤‘ìš” ì •ë³´

ì£¼ì˜ì‚¬í•­:
1. í˜ì´ì§€ì— ëª…ì‹œëœ ì •ë³´ë§Œ í¬í•¨í•˜ì„¸ìš”
2. ëª…ì‹œë˜ì§€ ì•Šì€ ì¹´í…Œê³ ë¦¬ëŠ” ì ˆëŒ€ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš” (ì¶”ë¡  ê¸ˆì§€)
3. í•„ìš” ì—†ëŠ” ì„¹ì…˜ì€ ìƒëµí•´ë„ ë©ë‹ˆë‹¤
4. ìš”ê¸ˆì€ í•œê¸€ í‘œê¸° ìœ ì§€ (ì˜ˆ: "10,000ì›~20,000ì›")
5. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ë§Œ ì‘ë‹µí•˜ì„¸ìš” (JSONì´ ì•„ë‹™ë‹ˆë‹¤)"""


def register_detail_content_prompts(prompt_service) -> Dict[str, str]:
    """
    ì„¸ë¶€ë‚´ì—­ ì½˜í…ì¸  ì¶”ì¶œ í”„ë¡¬í”„íŠ¸ë¥¼ í”„ë¡¬í”„íŠ¸ ì„œë¹„ìŠ¤ì— ë“±ë¡í•©ë‹ˆë‹¤.

    ì£¼ì˜: ì´ í•¨ìˆ˜ëŠ” Feature Registryì—ë§Œ í”„ë¡¬í”„íŠ¸ ì •ë³´ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
    ì‹¤ì œ í”„ë¡¬í”„íŠ¸ íŒŒì¼ì€ data/prompts/templates/ì— ë¯¸ë¦¬ ì €ì¥ë˜ì–´ ìˆìœ¼ë©°,
    ë¡œë“œ ì‹œ ë¡œì»¬ íŒŒì¼ì—ì„œ ì§ì ‘ ë¡œë“œë©ë‹ˆë‹¤.

    Args:
        prompt_service: PromptService ì¸ìŠ¤í„´ìŠ¤

    Returns:
        ë“±ë¡ëœ í”„ë¡¬í”„íŠ¸ ID ë”•ì…”ë„ˆë¦¬ {'info': prompt_id, 'fee': prompt_id}
    """
    from src.app.core.logger import get_logger
    logger = get_logger(__name__)

    try:
        # ê³ ì • í”„ë¡¬í”„íŠ¸ ID (data/prompts/templates/ì— ì €ì¥ëœ íŒŒì¼ëª…)
        INFO_PROMPT_ID = "14d2ce15-8127-4b77-9be4-a0cb56600ead"
        FEE_PROMPT_ID = "9c063a86-23a1-40b0-beb8-f132cc6572d9"

        # Feature Registryì—ë§Œ í”„ë¡¬í”„íŠ¸ ì •ë³´ ë“±ë¡
        from src.app.core.prompt_feature_registry import PromptFeatureRegistry
        registry = PromptFeatureRegistry()

        # ë°°ì¶œì •ë³´ ì„¸ë¶€ë‚´ì—­ ê¸°ëŠ¥ ë“±ë¡
        registry.register_feature(
            feature_id="detail_content_disposal_info",
            name="ì„¸ë¶€ë‚´ì—­ ë°°ì¶œì •ë³´ ê´€ë¦¬",
            description="ì§€ì—­ë³„ ëŒ€í˜•íê¸°ë¬¼ ë°°ì¶œì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œí•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤",
            category="infrastructure",
            is_active=True,
            required_services=["openai_service"],
            default_prompt_template="",  # ë¹ˆ ë¬¸ìì—´ (ë¡œì»¬ íŒŒì¼ì—ì„œ ë¡œë“œ)
            metadata={
                "content_type": "info",
                "feature_type": "detail_content",
                "prompt_id": INFO_PROMPT_ID
            }
        )

        # ìˆ˜ìˆ˜ë£Œ ì„¸ë¶€ë‚´ì—­ ê¸°ëŠ¥ ë“±ë¡
        registry.register_feature(
            feature_id="detail_content_fee_info",
            name="ì„¸ë¶€ë‚´ì—­ ìˆ˜ìˆ˜ë£Œ ê´€ë¦¬",
            description="ì§€ì—­ë³„ ëŒ€í˜•íê¸°ë¬¼ ìˆ˜ìˆ˜ë£Œ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œí•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤",
            category="infrastructure",
            is_active=True,
            required_services=["openai_service"],
            default_prompt_template="",  # ë¹ˆ ë¬¸ìì—´ (ë¡œì»¬ íŒŒì¼ì—ì„œ ë¡œë“œ)
            metadata={
                "content_type": "fee",
                "feature_type": "detail_content",
                "prompt_id": FEE_PROMPT_ID
            }
        )

        logger.info(f"ì„¸ë¶€ë‚´ì—­ Feature Registry ë“±ë¡ ì™„ë£Œ: info={INFO_PROMPT_ID}, fee={FEE_PROMPT_ID}")
        logger.info(f"í”„ë¡¬í”„íŠ¸ëŠ” ë¡œì»¬ íŒŒì¼ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤: data/prompts/templates/")
        return {
            'info': INFO_PROMPT_ID,
            'fee': FEE_PROMPT_ID
        }

    except Exception as e:
        logger.error(f"ì„¸ë¶€ë‚´ì—­ í”„ë¡¬í”„íŠ¸ ë“±ë¡ ì‹¤íŒ¨: {e}")
        return {}
